jQuery(document).ready(function(a){function b(b){a(".message").text(b?b:""),k.hide(),a("#photo-no").val(i),a("#bib-tagging-start").show()}function c(){i++,f()}function d(){i--,1>i&&(i=1),f()}function e(){var c=l.val();c=c.replace(/\+/g,",");var d={action:"save_bib_tags",year:h,n:i,tags:c};a.post(ajaxurl,d,function(a){"1"!==a&&(i=d.n,b("Tags could not be saved"))})}function f(){var c={action:"get_gallery_image",year:h,n:i,size:j};m.fadeIn(),a.get(ajaxurl,c,function(c){if("0"==c)i=1,b("No more photos found");else{c=a.parseJSON(c),k.find(".image.current").remove(),k.find(".photo-no").text(c.n+" of "+c.total);var d=g(c.src);d||(d=a('<img src="'+c.src+'" alt="" />')),a('<a class="image current" href="'+c.full_src+'" target="_blank"></a>').append(d).appendTo(k.find(".image-area")),a.each(c.preload,function(b,c){g(c)||a('<img src="'+c+'" alt="" />').appendTo(k.find(".preload-area"))}),l.val(c.tags),l.focus(),l[0].select(),imagesLoaded(d,function(){m.fadeOut()})}})}function g(a){var b=k.find(".preload-area img[src='"+a+"']");return b.length?b:!1}var h,i,j,k,l,m;k=a("#bib-tagging-container"),l=a("#bib-tags"),m=k.find(".loading"),a("#tag-button").click(function(){h=a("#gallery-year").val(),i=parseInt(a("#photo-no").val(),10),j=a("#image-size").val(),a("#bib-tagging-start").hide(),k.show(),f()}),k.find(".back").click(function(a){a.preventDefault(),b()}),k.find(".save").click(function(a){a.preventDefault(),e(),c()}),k.find(".next").click(function(a){a.preventDefault(),c()}),k.find(".prev").click(function(a){a.preventDefault(),d()}),a(document).keyup(function(a){k.is(":visible")&&(27==a.keyCode?b():65==a.keyCode?d():83==a.keyCode?c():13==a.keyCode&&(e(),c()))}),l.keypress(function(a){return/[0-9,+]/.test(String.fromCharCode(a.keyCode))?void 0:!1})});